<!DOCTYPE html><html><head><meta charset="utf-8"><style>@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

* {
    box-sizing: border-box;
}

body {
    width: 980px;
    margin-right: auto;
    margin-left: auto;
}

body .markdown-body {
    padding: 45px;
    border: 1px solid #ddd;
    border-radius: 3px;
    word-wrap: break-word;
}

pre {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  color: #333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body input {
  font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4078c0;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .select::-ms-expand {
  opacity: 0;
}

.markdown-body .octicon {
  font: normal normal normal 16px/1 octicons-anchor;
  display: inline-block;
  text-decoration: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body:before {
  display: table;
  content: "";
}

.markdown-body:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body .anchor {
  display: inline-block;
  padding-right: 2px;
  margin-left: -18px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #000;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h1 .anchor {
  line-height: 1;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 .anchor {
  line-height: 1;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h3 .anchor {
  line-height: 1.2;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h4 .anchor {
  line-height: 1.2;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h5 .anchor {
  line-height: 1.1;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body h6 .anchor {
  line-height: 1.1;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  box-sizing: content-box;
  background-color: #fff;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .pl-c {
  color: #969896;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #0086b3;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #795da3;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #333;
}

.markdown-body .pl-ent {
  color: #63a35c;
}

.markdown-body .pl-k {
  color: #a71d5d;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #183691;
}

.markdown-body .pl-v {
  color: #ed6a43;
}

.markdown-body .pl-id {
  color: #b52a1d;
}

.markdown-body .pl-ii {
  background-color: #b52a1d;
  color: #f8f8f8;
}

.markdown-body .pl-sr .pl-cce {
  color: #63a35c;
  font-weight: bold;
}

.markdown-body .pl-ml {
  color: #693a17;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #1d3e81;
  font-weight: bold;
}

.markdown-body .pl-mq {
  color: #008080;
}

.markdown-body .pl-mi {
  color: #333;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #333;
  font-weight: bold;
}

.markdown-body .pl-md {
  background-color: #ffecec;
  color: #bd2c00;
}

.markdown-body .pl-mi1 {
  background-color: #eaffea;
  color: #55a532;
}

.markdown-body .pl-mdr {
  color: #795da3;
  font-weight: bold;
}

.markdown-body .pl-mo {
  color: #1d3e81;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .plan-price-unit {
  color: #767676;
  font-weight: normal;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 0.35em 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body .plan-choice {
  padding: 15px;
  padding-left: 40px;
  display: block;
  border: 1px solid #e0e0e0;
  position: relative;
  font-weight: normal;
  background-color: #fafafa;
}

.markdown-body .plan-choice.open {
  background-color: #fff;
}

.markdown-body .plan-choice.open .plan-choice-seat-breakdown {
  display: block;
}

.markdown-body .plan-choice-free {
  border-radius: 3px 3px 0 0;
}

.markdown-body .plan-choice-paid {
  border-radius: 0 0 3px 3px;
  border-top: 0;
  margin-bottom: 20px;
}

.markdown-body .plan-choice-radio {
  position: absolute;
  left: 15px;
  top: 18px;
}

.markdown-body .plan-choice-exp {
  color: #999;
  font-size: 12px;
  margin-top: 5px;
}

.markdown-body .plan-choice-seat-breakdown {
  margin-top: 10px;
  display: none;
}

.markdown-body :checked+.radio-label {
  z-index: 1;
  position: relative;
  border-color: #4078c0;
}
</style><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  config: ["MMLorHTML.js"],
  extensions: ["tex2jax.js"],
  jax: ["input/TeX"],
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: false
  },
  TeX: {
    extensions: ["AMSmath.js", "AMSsymbols.js"],
    TagSide: "right",
    TagIndent: ".8em",
    MultLineWidth: "85%",
    equationNumbers: {
      autoNumber: "AMS",
    },
    unicode: {
      fonts: "STIXGeneral,'Arial Unicode MS'"
    }
  },
  showProcessingMessages: false
});
</script>
<title>Rapport</title></head><body><article class="markdown-body"><p><strong>Benjamin RIVIERE, GI04</strong></p>
<h1>
<a id="user-content-les-trajets-des-taxis-à-porto" class="anchor" href="#les-trajets-des-taxis-%C3%A0-porto" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Les trajets des taxis à Porto</h1>
<h2>
<a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>
<p>L'objectif de ces séances de TD a été de mettre en place un <em>data warehouse</em> sous Cassandra, SGBD orienté colonne. Pour beaucoup, cela a été une première approche du NoSQL.</p>
<p>Le jeu de données utilisé est <a href="https://archive.ics.uci.edu/ml/datasets/Taxi+Service+Trajectory+-+Prediction+Challenge,+ECML+PKDD+2015">l'ensemble des trajets des taxis</a> de la ville de Porto (Portugal) sur 1 an (entre début Juillet 2013 et fin Juillet 2014).</p>
<p>Premièrement, il a fallut cibler les questions auxquelles on souhaitait répondre afin de concevoir le modèle de données. Une fois le modèle de données réalisé, il a fallut l'implémenter. Bien entendu, des données pouvaient être erronées ou manquantes, il a donc fallut les nettoyer.</p>
<p>Le traitement des données s'effectue via Python 3.</p>
<h2>
<a id="user-content-description-des-données" class="anchor" href="#description-des-donn%C3%A9es" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Description des données</h2>
<p>En regardant les données, nous pouvons faire plusieurs remarques intéressantes :</p>
<ul>
<li>Les IDs des courses sont de la forme <code>TIMESTAMP + '6' + TAXI_ID</code> où <code>+</code> représente l'opérateur de concaténation.</li>
<li>Les coordonnées ne sont pas dans un format usuel (généralement <code>[latitude, longitude]</code>), elles sont représentées par le couple <code>[longitude, latitude]</code>. Il faudra prendre en compte cette particularité lors de nos calculs de distance ou si l'on souhaite représenter les trajets sur un fond de carte.</li>
<li>Les coordonnées couvertes par les trajets vont bien plus loin que la ville de Porto elle-même (<strong>A PRECISER</strong>). Pour gagner en précision, nous avons choisit de ne pas assimiler la surface de la ville à un plan mais de bien considérer la "sphéricité" (relative) de la Terre.</li>
<li>Les coordonnées (latitude ou longitude) sont parfois proche d'un trajet à un autre, sans pour autant être identiques. Nous avons donc regroupé les coordonnées par "zone". (<strong>EXPLIQUER LA METHODE UTILISEE</strong>)</li>
<li>Certaines données sont aberrantes (des points au milieu de l'Océan par exemple).</li>
<li>Certaines données ont été mal calculées (le type de jour par exemple).</li>
</ul>
<h2>
<a id="user-content-quelques-questions" class="anchor" href="#quelques-questions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quelques questions</h2>
<p>Comme nous l'avons dit, la conception du modèle de données dépend intimement des questions auxquelles nous souhaitons apporter une réponse. Voici quelques questions auxquelles nous aimerions répondre :</p>
<ul>
<li>Quels sont les taxis les plus utilisés ?</li>
<li>Quel est le type de course le plus populaire ?</li>
<li>Quels sont les jours d'affluence ?</li>
<li>Quelles sont les semaines d'affluence ?</li>
<li>Quelles sont les heures d'affluence ?</li>
<li>Quelles sont les zones de départ les plus populaires ?</li>
<li>Quelles sont les zones d'arrivée les plus populaires ?</li>
<li>Quelle est la distance moyenne d'un trajet ?</li>
<li>Quelle est la durée moyenne d'un trajet ?</li>
</ul>
<p>Cette liste de questions n'est bien entendu pas exhaustive.</p>
<h2>
<a id="user-content-modèle-conceptuel" class="anchor" href="#mod%C3%A8le-conceptuel" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Modèle conceptuel</h2>
<p>Afin de répondre à nos différentes questions, nous proposons les dimensions (ainsi que les différentes hiérarchies qui en découlent) suivantes :</p>
<ul>
<li>
<strong>Temps</strong>(année, mois, jour, heure, minutes, secondes, jourDeLaSemaine, semaine, période, typeDeJour)</li>
<li>
<strong>Lieux</strong>(zoneLon, zoneLat, lon, lat)</li>
<li>
<strong>Courses</strong>(tripID, taxiID, typeAppel, origineAppel, origineStand)</li>
</ul>
<p>L'attribut <em>période</em> de la dimension <strong>Temps</strong> est une chaîne de caractères représentant le moment de la journée (matin, midi, après-midi, soirée, etc.). Il n'est pas utilisé pour le moment.</p>
<p>Les faits sont liés aux dimensions précédentes. Pour la dimension <strong>Lieux</strong>, le lien est double car on a un lieux de départ et un lieux d'arrivée :
<strong>Faits</strong>(moment, course, départ, arrivée, durée, distance)</p>
<p>On peut synthétiser ce modèle via le schéma suivant.</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/NF26_Taxi_UML.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/NF26_Taxi_UML.png" alt="Schéma du modèle conceptuel de données" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-implémentation-réelle" class="anchor" href="#impl%C3%A9mentation-r%C3%A9elle" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Implémentation réelle</h2>
<h3>
<a id="user-content-idée-générale" class="anchor" href="#id%C3%A9e-g%C3%A9n%C3%A9rale" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Idée générale</h3>
<p>Le SGBD utilisé étant Cassandra (qui pousse à la dénormalisation), il y a une différence importante entre le modèle conceptuel de données et le modèle réel. Afin de faciliter les requête et l'exploitation des données via Python par la suite, nous avons choisit d'avoir une implémentation très redondante. Toutes les dimensions et les faits sont regroupées au sein d'une seule "table".</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/NF26_Impl%C3%A9mentation_UML.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/NF26_Impl%C3%A9mentation_UML.png" alt="Schéma de l'implémentation réelle sous Cassandra" style="max-width:100%;"></a></p>
<h3>
<a id="user-content-tables-sous-cassandra" class="anchor" href="#tables-sous-cassandra" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tables sous Cassandra</h3>
<p>Etant donné que l'on souhaite répondre à plusieurs questions qui nécessitent parfois des agrégations, on a plusieurs "tables" partitionnées et clusterisées différemment.</p>
<p>Pour bien répartir les données entre les différents de noeuds de Cassandra, il est important de faire en sorte de ne pas avoir des partitions trop grandes ou trop petites. Au sein d'une partition, les données sont organisées selon les <em>clusters</em> définis, ils sont donc important également.</p>
<p>Par exemple, on a créé une première "table" de faits qui partitionne les faits par jour.</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">IF</span> NOT EXISTS <span class="pl-c1">e21</span>.<span class="pl-c1">facts_by_day</span> (
    start_zone_lon FLOAT,
    start_zone_lat FLOAT,
    arrival_zone_lon FLOAT,
    arrival_zone_lat FLOAT,
    taxi_id <span class="pl-k">INT</span>,
    trip_id <span class="pl-k">BIGINT</span>,
    call_type <span class="pl-k">TEXT</span>,
    origin_call <span class="pl-k">TEXT</span>,
    origin_stand <span class="pl-k">TEXT</span>,  
    year <span class="pl-k">INT</span>,
    month <span class="pl-k">INT</span>,
    day <span class="pl-k">INT</span>,
    hour <span class="pl-k">INT</span>,
    minutes <span class="pl-k">INT</span>,
    seconds <span class="pl-k">INT</span>,
    day_of_week <span class="pl-k">INT</span>,
    week <span class="pl-k">INT</span>,
    period <span class="pl-k">TEXT</span>,
    day_type <span class="pl-k">TEXT</span>,  
    start_lon FLOAT,
    start_lat FLOAT,
    arrival_lon FLOAT,
    arrival_lat FLOAT,
    duration <span class="pl-k">INT</span>,
    distance FLOAT, 
    <span class="pl-k">PRIMARY KEY</span> ((year, month, day), hour, minutes, seconds, trip_id)
);</pre></div>
<p>On a donc la clef de partition suivante : <code>(year, month, day)</code>. Elle nous permet de partitionner par jour. Les données sont clusterisées selon l'heure, les minutes et les secondes (dans un premier temps). Un problème que l'on peut rencontrer sous Cassandra est au moment de l'insertion des données. En effet, si une données existe déjà, elle sera mise à jour de manière silencieuse. Afin de lever cette ambiguité, on clusterise également les données selon l'ID du trajet. Cette clef primaire nous permet également de pouvoir faire des agrégat (manuellement) sur les mois ou les années par exemple.</p>
<p>De même, on a définit plusieurs autres "tables" de faits pour répondre à d'autres questions :</p>
<ul>
<li>Une table de faits par zone de départ</li>
<li>Une table de faits par zone d'arrivée</li>
<li>Une table de faits par taxi</li>
<li>Une table de faits par distance</li>
<li>Une table de faits par durée</li>
<li>Une table de faits par jour de la semaine</li>
</ul>
<p>Pour la partition par zone de départ, on procède de la façon suivante : <code>PRIMARY KEY ((start_zone_lon, start_zone_lat), year, month, day, minutes, seconds, trip_id)</code>.
On a donc une partition sur la longitude et la latitude de la zone de départ. Le reste de la partition est clusterisé par année, mois, jour, minutes, secondes et également par ID de trajet (pour lever les ambiguités encore une fois). On aurait pu ajouter l'année dans la clef de partition afin de limiter la taille des partitions d'une année à l'autre. Néanmoins, le jeu de données ne couvre qu'une année de données donc on laissera l'année en <em>cluster</em>.</p>
<p>Il convient de prendre des précautions avec la table de faits partitionnée sur les distance car il est très probable que les distances des trajets soient toutes différentes. On aurait donc autant de partitions que de trajets, ce qui n'est pas souhaitable. Pour pallier ce problème, les faits sont partionnés par une distance arrondie, afin de regrouper les distances "semblables". On clusterise ensuite sur la distance réelle (avant de clusteriser sur d'autres attributs pour lever les ambiguités) : <code>PRIMARY KEY (truncated_distance, distance, year, month, day, minutes, seconds, trip_id)</code></p>
<p>De même que pour la "table" de faits partionnée par jour, la "table" de faits partitionnée par jour de la semaine nous permet de faire des agrégats sur le jour de la semaine, la semaine ou l'année.</p>
<h2>
<a id="user-content-traitement-des-données" class="anchor" href="#traitement-des-donn%C3%A9es" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Traitement des données</h2>
<p>Comme expliqué précédemment, certaines données étaient erronées ou mal calculées. Il a donc fallu corriger tout cela.</p>
<h4>
<a id="user-content-type-de-jour" class="anchor" href="#type-de-jour" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Type de jour</h4>
<p>Dans l'énoncé du jeu de données, il nous est indiqué que ce champ a été mal calculé. Ce champ prend plusieurs valeurs en fonction de la date du jour correspondant :</p>
<ul>
<li>Type <strong>B</strong> : Le trajet a démarré pendant un jour de vacances ou un jour spécial (jour férié, etc.).</li>
<li>Type <strong>C</strong> : Le trajet a démarré pendant un jour précédant un jour de type B.</li>
<li>Type <strong>A</strong> : Les autres jours (même le week-end).</li>
</ul>
<p>Dans un premier temps, on a récupéré les jours des vacances au Portugal pour l'année <a href="http://holidays.retira.eu/archive/portugal/2013/">2013</a> et <a href="http://holidays.retira.eu/archive/portugal/2014/">2014</a>. Dans ces listes, il y a également des jours normaux ou des fêtes régionales. Il faut donc faire le tri. Nous n'avons conservé que les vacances nationales.</p>
<p>Par la suite, il suffit de comparer la date issue du <em>timestamp</em> de chaque trajet avec cette liste de dates (et les jours qui les précèdent) pour déterminant le type de jour.</p>
<h4>
<a id="user-content-coordonnées" class="anchor" href="#coordonn%C3%A9es" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Coordonnées</h4>
<p>Pour cibler les données aberrantes, on choisit de définir une zone où les données sont considérées comme valides. En effet, un point au milieu de l'Océan n'a pas beaucoup de sens.</p>
<p>On choisit de resteindre la longitude à l'intervalle [-8,8; -8] et la latitude à l'interval [40,8; 41,5]. Cela correspond au rectangle rouge sur le fond de carte suivant.</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/map.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/map.png" alt="Surface prise en compte" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-requêtes-et-résultats" class="anchor" href="#requ%C3%AAtes-et-r%C3%A9sultats" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requêtes et résultats</h2>
<p>Voici quelques exemples de requêtes possibles.</p>
<h4>
<a id="user-content-les-classes-de-distance" class="anchor" href="#les-classes-de-distance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Les "classes" de distance</h4>
<p>Ici, les distances sont partitionnées aux 100 mètres près.</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">SELECT</span> truncated_distance, <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>)
<span class="pl-k">FROM</span> <span class="pl-c1">e21</span>.<span class="pl-c1">facts_by_distance</span>
<span class="pl-k">GROUP BY</span> truncated_distance;</pre></div>
<p><strong>MOYENNE, etc.</strong>  ? (si moyenne, il faut le faire par rapport aux valeurs réelles)</p>
<h4>
<a id="user-content-les-classes-de-durée" class="anchor" href="#les-classes-de-dur%C3%A9e" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Les "classes" de durée</h4>
<p>Ici, les données sont partitionnées aux 100 secondes près (1 minute et 40 secondes). C'était la méthode la plus simple pour arrondir les durées. On aurait pu faire des partitions différentes, à la minute par exemple.</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">SELECT</span> truncated_duration, <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>)
<span class="pl-k">FROM</span> <span class="pl-c1">e21</span>.<span class="pl-c1">facts_by_duration</span>
<span class="pl-k">GROUP BY</span> truncated_duration;</pre></div>
<p><strong>MOYENNE, etc.</strong>  ? (si moyenne, il faut le faire par rapport aux valeurs réelles)</p>
<h4>
<a id="user-content-laffluence-en-fonction-du-temps" class="anchor" href="#laffluence-en-fonction-du-temps" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>L'affluence en fonction du temps</h4>
<p>On peut s'intéresser aux nombre de trajets total par jour (affluence cumulée).</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">SELECT</span> day_of_week, <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>)
<span class="pl-k">FROM</span> <span class="pl-c1">e21</span>.<span class="pl-c1">facts_by_week_day</span>
<span class="pl-k">GROUP BY</span> year, week, day_of_week;</pre></div>
<p>Le résultat retourné par cette requête est un agrégat du nombre de trajets par an par semaine par jour de la semaine. Il faut donc agréger de nouveau sur le jour de la semaine (on ne travaille que sur un an de données).</p>
<p>Si l'on représente le résultat à l'aide d'un diagramme en barre, on remarque que les jours de plus forte affluence sont le vendredi et le samedi. Cela paraît logique car cela est souvent les jours où les gens sortent et on besoin de se déplacer.</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/trips_by_week_day.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/trips_by_week_day.png" alt="Affluence cumulée en fonction des jours" style="max-width:100%;"></a></p>
<p><strong>Note :</strong> On pourra utiliser la même table pour faire des calculs sur les semaines. Il suffira alors de faire les aggrégations à la main ! Cela n'a pas forcément d'intérêt ici dans la mesure où nous allons regarder le nombre de trajet par mois, résultat sûrement plus parlant.</p>
<p>On peut également s'intéresser au nombre de trajets par mois. De même que pour les jour de la semaine, on obtient un résultat par année par mois par jour. Il faut donc agréger sur les mois à la main.</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">SELECT</span> month, <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>)
<span class="pl-k">FROM</span> <span class="pl-c1">e21</span>.<span class="pl-c1">facts_by_day</span>
<span class="pl-k">GROUP BY</span> year, month, day;</pre></div>
<p>On obtient alors le diagramme en barres suivant.</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/trips_by_month.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/trips_by_month.png" alt="Affluence cumulée en fonction des mois" style="max-width:100%;"></a></p>
<p><strong>A REGENERER + REMARQUES</strong></p>
<h4>
<a id="user-content-lieux-de-départ-les-plus-populaires" class="anchor" href="#lieux-de-d%C3%A9part-les-plus-populaires" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lieux de départ les plus populaires</h4>
<h4>
<a id="user-content-lieux-darrivée-les-plus-populaires" class="anchor" href="#lieux-darriv%C3%A9e-les-plus-populaires" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lieux d'arrivée les plus populaires</h4>
<h4>
<a id="user-content-trajets-les-plus-courants" class="anchor" href="#trajets-les-plus-courants" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Trajets les plus courants</h4>
<h4>
<a id="user-content-les-taxis-les-plus-utilisés" class="anchor" href="#les-taxis-les-plus-utilis%C3%A9s" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Les taxis les plus utilisés</h4>
<h2>
<a id="user-content-classification" class="anchor" href="#classification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Classification</h2>
<p>A présent, on se focalise sur un problème de classification. On peut se dire qu'en "découpant" notre ensemble de départs ou d'arrivées en K classes, les K centroïdes de ces classes représenteraient les points de départ ou d'arrivée les plus courant. Il faudra tenir compte de la dispersion de chaque classe.</p>
<p>Nous allons donc lancer un algorithme <em>k-means</em> sur nos lieux de départ et d'arrivée pour <em>k</em> = 5 afin d'obtenir les 5 lieux les plus populaires. Nous utiliserons la librairie Python <code>sklearn</code> qui offre plusieurs algorithme de classification dont <em>k-means</em>. Elle est relativement facile d'utilisation.</p>
<p>On travaillera sur les "zones" de chaque point afin d'obtenir une zone par classe. <strong>A VERIFIER, inertie plus grande quand on travaille sur les zones</strong></p>
<p>En faisant un apprentissage sur 100 000 trajets, on obtient les centres d'inerties suivants.</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/kmeans-map-100000.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/kmeans-map-100000.png" alt="Centres d'inerties des 5 classes pour un échantillon de taille 100 000" style="max-width:100%;"></a></p>
<p>En regardant plus précisemment sur Google Maps, on observe que bien souvent, ces centres sont proches d'une église, d'un hôpital, d'une grande école ou d'un quartier résidentiel important.</p>
<p>En lançant une classification sur le jeu de données totale, on obtient quelque chose de similaire. On note la présence d'une classe un peu aberrante. Il est probable que ce soit un trajet unique dont la destination est trop écartée des autres point pour pouvoir être classifiée dans une autre classe. Il faut sûrement revoir le rectangle de recherche définit précédemment.</p>
<p><a href="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/kmeans-map.png" target="_blank"><img src="///D://Benjamin/Documents/UTC/GI04/NF26/TDs/TD6/kmeans-map.png" alt="Centres d'inerties des 5 classes pour le jeu de données total" style="max-width:100%;"></a></p>
<h2>
<a id="user-content-conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Conclusion</h2>
</article></body></html>